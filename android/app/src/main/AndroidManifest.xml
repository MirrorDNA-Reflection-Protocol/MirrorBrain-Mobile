<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- Core permissions -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    <uses-permission android:name="android.permission.READ_CALENDAR" />
    <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />

    <!-- Sovereign AI Operating Layer permissions -->
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
    <uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_SPECIAL_USE" />

    <!-- Sprint 3: Location & Geofencing -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION" />

    <!-- Sprint 3: Screenshot OCR -->
    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />

    <!-- Personal Assistant: Voice Interaction -->
    <uses-permission android:name="android.permission.BIND_VOICE_INTERACTION" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_MICROPHONE" />

    <!-- Wake Word Detection -->
    <uses-feature android:name="android.hardware.microphone" android:required="false" />

    <!-- Camera Vision -->
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-feature android:name="android.hardware.camera" android:required="false" />
    <uses-feature android:name="android.hardware.camera.autofocus" android:required="false" />

    <!-- Android 11+ external storage access for Pixel Vault -->
    <uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE"
        tools:ignore="ScopedStorage" />

    <!-- Android 11+ package visibility for launching other apps -->
    <queries>
        <!-- Speech recognition -->
        <intent>
            <action android:name="android.speech.RecognitionService" />
        </intent>
        <package android:name="com.google.android.googlequicksearchbox" />
        <package android:name="md.obsidian" />
        <!-- Sprint 3: Messaging apps for automation -->
        <package android:name="com.whatsapp" />
        <package android:name="org.telegram.messenger" />
        <package android:name="com.google.android.apps.messaging" />
        <package android:name="com.Slack" />
        <package android:name="com.slack" />
        <package android:name="com.discord" />
        <intent>
            <action android:name="android.intent.action.VIEW" />
            <data android:scheme="obsidian" />
        </intent>
        <intent>
            <action android:name="android.intent.action.VIEW" />
            <data android:scheme="market" />
        </intent>
        <!-- WhatsApp deep links -->
        <intent>
            <action android:name="android.intent.action.VIEW" />
            <data android:scheme="https" android:host="api.whatsapp.com" />
        </intent>
        <!-- Telegram deep links -->
        <intent>
            <action android:name="android.intent.action.VIEW" />
            <data android:scheme="tg" />
        </intent>
        <!-- SMS intent -->
        <intent>
            <action android:name="android.intent.action.SENDTO" />
            <data android:scheme="smsto" />
        </intent>
    </queries>

    <application
      android:name=".MainApplication"
      android:label="@string/app_name"
      android:icon="@mipmap/ic_launcher"
      android:roundIcon="@mipmap/ic_launcher_round"
      android:allowBackup="false"
      android:theme="@style/AppTheme"
      android:requestLegacyExternalStorage="true"
      android:usesCleartextTraffic="true"
      android:networkSecurityConfig="@xml/network_security_config"
      android:supportsRtl="true">

      <!-- OpenCL for GPU acceleration (Pixel 9 Pro XL) -->
      <uses-native-library android:name="libOpenCL.so" android:required="false" />

      <!-- FileProvider for camera image sharing -->
      <provider
          android:name="androidx.core.content.FileProvider"
          android:authorities="${applicationId}.fileprovider"
          android:exported="false"
          android:grantUriPermissions="true">
          <meta-data
              android:name="android.support.FILE_PROVIDER_PATHS"
              android:resource="@xml/file_paths" />
      </provider>

      <service
          android:name="com.mirrorbrainmobile.service.AgentService"
          android:enabled="true"
          android:exported="false"
          android:foregroundServiceType="dataSync" />

      <!-- Passive Intelligence: Notification Interceptor -->
      <service
          android:name="com.mirrorbrainmobile.passive.NotificationInterceptorService"
          android:label="MirrorBrain Notifications"
          android:permission="android.permission.BIND_NOTIFICATION_LISTENER_SERVICE"
          android:exported="false">
          <intent-filter>
              <action android:name="android.service.notification.NotificationListenerService" />
          </intent-filter>
      </service>

      <!-- Passive Intelligence: Headless JS task for notification processing -->
      <service
          android:name="com.mirrorbrainmobile.passive.NotificationTaskService"
          android:enabled="true"
          android:exported="false" />

      <!-- Passive Intelligence: Screen Context Accessibility -->
      <service
          android:name="com.mirrorbrainmobile.passive.ScreenContextService"
          android:label="MirrorBrain Screen Reader"
          android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"
          android:exported="false">
          <intent-filter>
              <action android:name="android.accessibilityservice.AccessibilityService" />
          </intent-filter>
          <meta-data
              android:name="android.accessibilityservice"
              android:resource="@xml/accessibility_service_config" />
      </service>

      <!-- Root Daemon: Background service -->
      <service
          android:name="com.mirrorbrainmobile.root.DaemonService"
          android:enabled="true"
          android:exported="false"
          android:foregroundServiceType="specialUse">
          <property
              android:name="android.app.PROPERTY_SPECIAL_USE_FGS_SUBTYPE"
              android:value="ambient_intelligence" />
      </service>

      <!-- Gesture Detection Service -->
      <service
          android:name="com.mirrorbrainmobile.gesture.GestureDetectorService"
          android:enabled="true"
          android:exported="false"
          android:foregroundServiceType="specialUse">
          <property
              android:name="android.app.PROPERTY_SPECIAL_USE_FGS_SUBTYPE"
              android:value="gesture_detection" />
      </service>

      <!-- Overlay Service: Floating bubble -->
      <service
          android:name="com.mirrorbrainmobile.overlay.OverlayService"
          android:enabled="true"
          android:exported="false"
          android:foregroundServiceType="specialUse">
          <property
              android:name="android.app.PROPERTY_SPECIAL_USE_FGS_SUBTYPE"
              android:value="floating_overlay" />
      </service>

      <!-- Boot Receiver: Start daemon on boot -->
      <receiver
          android:name="com.mirrorbrainmobile.root.DaemonBootReceiver"
          android:enabled="true"
          android:exported="false">
          <intent-filter>
              <action android:name="android.intent.action.BOOT_COMPLETED" />
              <action android:name="android.intent.action.LOCKED_BOOT_COMPLETED" />
              <action android:name="android.intent.action.QUICKBOOT_POWERON" />
              <action android:name="android.intent.action.MY_PACKAGE_REPLACED" />
          </intent-filter>
      </receiver>

      <!-- Quick Capture Activity: Translucent overlay -->
      <activity
          android:name="com.mirrorbrainmobile.capture.QuickCaptureActivity"
          android:label="Quick Capture"
          android:theme="@android:style/Theme.Translucent.NoTitleBar"
          android:excludeFromRecents="true"
          android:noHistory="true"
          android:exported="false" />

      <!-- Home Screen Widget -->
      <receiver
          android:name="com.mirrorbrainmobile.widget.MirrorBrainWidgetProvider"
          android:label="@string/widget_name"
          android:exported="true">
          <intent-filter>
              <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
              <action android:name="com.mirrorbrainmobile.widget.QUICK_CAPTURE" />
              <action android:name="com.mirrorbrainmobile.widget.REFRESH" />
              <action android:name="com.mirrorbrainmobile.widget.OPEN_APP" />
          </intent-filter>
          <meta-data
              android:name="android.appwidget.provider"
              android:resource="@xml/mirror_widget_info" />
      </receiver>

      <!-- Sprint 3: Geofence Receiver -->
      <receiver
          android:name="com.mirrorbrainmobile.location.GeofenceReceiver"
          android:enabled="true"
          android:exported="false" />

      <!-- Personal Assistant: Voice Interaction Service -->
      <service
          android:name="com.mirrorbrainmobile.assistant.MirrorAssistantService"
          android:label="MirrorBrain Assistant"
          android:permission="android.permission.BIND_VOICE_INTERACTION"
          android:exported="true">
          <meta-data
              android:name="android.voice_interaction"
              android:resource="@xml/voice_interaction_service" />
          <intent-filter>
              <action android:name="android.service.voice.VoiceInteractionService" />
          </intent-filter>
      </service>

      <!-- Personal Assistant: Voice Session Service -->
      <service
          android:name="com.mirrorbrainmobile.assistant.MirrorSessionService"
          android:permission="android.permission.BIND_VOICE_INTERACTION"
          android:exported="false" />

      <!-- Wake Word Detection Service -->
      <service
          android:name="com.mirrorbrainmobile.assistant.WakeWordService"
          android:enabled="true"
          android:exported="false"
          android:foregroundServiceType="microphone">
      </service>

      <!-- Quick Settings Tile -->
      <service
          android:name="com.mirrorbrainmobile.tile.MirrorTileService"
          android:label="MirrorBrain"
          android:icon="@mipmap/ic_launcher"
          android:permission="android.permission.BIND_QUICK_SETTINGS_TILE"
          android:exported="true">
          <intent-filter>
              <action android:name="android.service.quicksettings.action.QS_TILE" />
          </intent-filter>
          <meta-data
              android:name="android.service.quicksettings.ACTIVE_TILE"
              android:value="true" />
      </service>

      <!-- Share Intent Handler Activity -->
      <activity
          android:name="com.mirrorbrainmobile.share.ShareReceiverActivity"
          android:label="MirrorBrain"
          android:theme="@style/Theme.AppCompat.Light.Dialog"
          android:excludeFromRecents="true"
          android:noHistory="true"
          android:exported="true">
          <intent-filter>
              <action android:name="android.intent.action.SEND" />
              <category android:name="android.intent.category.DEFAULT" />
              <data android:mimeType="text/*" />
          </intent-filter>
          <intent-filter>
              <action android:name="android.intent.action.SEND" />
              <category android:name="android.intent.category.DEFAULT" />
              <data android:mimeType="image/*" />
          </intent-filter>
          <intent-filter>
              <action android:name="android.intent.action.SEND" />
              <category android:name="android.intent.category.DEFAULT" />
              <data android:mimeType="*/*" />
          </intent-filter>
          <intent-filter>
              <action android:name="android.intent.action.SEND_MULTIPLE" />
              <category android:name="android.intent.category.DEFAULT" />
              <data android:mimeType="image/*" />
          </intent-filter>
      </activity>

      <activity
        android:name=".MainActivity"
        android:label="@string/app_name"
        android:configChanges="keyboard|keyboardHidden|orientation|screenLayout|screenSize|smallestScreenSize|uiMode"
        android:launchMode="singleTask"
        android:windowSoftInputMode="adjustResize"
        android:exported="true">
        
        <!-- Standard app launcher -->
        <intent-filter>
            <action android:name="android.intent.action.MAIN" />
            <category android:name="android.intent.category.LAUNCHER" />
        </intent-filter>
        
        <!-- Home screen replacement -->
        <intent-filter>
            <action android:name="android.intent.action.MAIN" />
            <category android:name="android.intent.category.HOME" />
            <category android:name="android.intent.category.DEFAULT" />
        </intent-filter>
      </activity>
    </application>
</manifest>
